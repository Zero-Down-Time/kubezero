{{- define "_ingress" }}
enabled: {{ .enabled }}
{{- with .gateway }}
gateways:
  istio-ingressgateway:
    {{- toYaml . | nindent 6 }}
{{- end }}
certificates:
{{- with .dnsNames }}
# Legacy to be removed with 1.21 !!
- name: ingress-cert
  dnsNames:
  {{- toYaml . | nindent 4 }}
{{- end }}
{{- range $cert := .certificates }}
- name: {{ $cert.name }}
  dnsNames:
  {{- toYaml $cert.dnsNames | nindent 4 }}
{{- end }}
proxyProtocol: {{ default true .proxyProtocol }}
{{- end }}


{{- define "istio-ingress-values" }}

{{- with index .Values "istio-ingress" "global" }}
global:
  {{- toYaml . | nindent 2 }}
{{- end }}

{{- with index .Values "istio-ingress" "public" }}
istio-ingress:
  telemetry:
    enabled: {{ $.Values.metrics.enabled }}
{{- include "_ingress" . | nindent 2 }}
{{- end }}

{{- with index .Values "istio-ingress" "private" }}
istio-private-ingress:
  telemetry:
    enabled: {{ $.Values.metrics.enabled }}
{{- include "_ingress" . | nindent 2 }}
{{- end }}

{{- end }}


{{- define "istio-ingress-argo" }}
{{- end }}

{{ include "kubezero-app.app" . }}
